%%
%% texjazz-caption.ltx
%%
%% A LaTeX file to configure captions.
%%
%% Copyright (c) 2020-2021 ejazz. 
%%
%---------------------------------------------------------------------------------------------------
% This work is part of the TeXjazz bundle. It may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% The Current Maintainer of this work is ejazz <ejazz.fr@gmail.com>.
%
% This work consists of the files:
%     `texjazz-caption.ltx' and `texjazz-caption[-fr].tex' (not yet fully available).
%---------------------------------------------------------------------------------------------------

%-- File identification
%----------------------

\ProvidesFile{texjazz-caption.ltx}%
  [2021/02/08 v0.1a − Configuring captions in a document]

%-- Gestion des légendes de flottants
%------------------------------------

%- Powerful helper package for setting caption layouts
\RequirePackage{caption}% To be loaded *after* french-babel

%-- Format des légendes / Captions formating
%-------------------------------------------

%- Caption layout
\newcommand{\captionlayout}{%
  \raisebox{-.25\baselineskip}{\tikz\fill[secondcolor] (0,0) rectangle (1mm, \baselineskip);}%
}

%- Defining a 'jazz caption' style
\DeclareCaptionLabelFormat{jazzcaptionlabelfmt}{% name=#1 and number=#2
  \captionlayout\enspace\textcolor{black!80}{\textsc{#1}}\space#2%
}
\DeclareCaptionLabelSeparator{jazzcaptionlabelsep}{% "French" label separator
  %\textcolor{secondcolor}{\enspace\textemdash{}\enspace}%
  \space\textcolor{secondcolor}{\textemdash}\space%
}
\DeclareCaptionTextFormat{jazzcaptiontext}{%
  \color{black}#1%\hskip 1pt #1%
}
\DeclareCaptionStyle{jazzcaptionstyle}{%
  labelsep=jazzcaptionlabelsep,
  labelformat=jazzcaptionlabelfmt,
  textformat=jazzcaptiontext,
  format=hang,
  % format=plain,
  singlelinecheck=false,
  justification=justified,
  %indention={1mm+0.5em},% layout width + \enspace
  font=footnotesize,
  textfont=it,
  width=\linewidth,
  list=true,
  skip=5pt,
  %hypcap=true, %hypcapspace=\baselineskip,
}

%- Defining a 'jazz caption basic' style
\DeclareCaptionLabelFormat{jazzcaptionbasiclabelfmt}{% no name=#1 and no number=#2
  \captionlayout%
}
\DeclareCaptionLabelSeparator{jazzcaptionbasiclabelsep}{% no label separator just horizontal space
  \enspace% \enspace = 0.5em
}
\DeclareCaptionTextFormat{jazzcaptionbasictext}{%
  \color{black}#1%\hskip 1pt #1%
}
\DeclareCaptionStyle{jazzcaptionbasicstyle}{%
  labelsep=jazzcaptionbasiclabelsep,
  labelformat=jazzcaptionbasiclabelfmt,
  textformat=jazzcaptionbasictext,
  format=hang,
  % format=plain,
  singlelinecheck=false,
  justification=justified,
  %indention={1mm+0.5em},% layout width + \enspace
  font=footnotesize,
  textfont=it,
  width=\linewidth,
  list=true,
  skip=5pt,
  %hypcap=true, %hypcapspace=\baselineskip,
}

%- Application selon le type de flottants
\captionsetup[figure]{% Figure
  style=jazzcaptionstyle, position=bottom, %justification=raggedleft,
  width=\linewidth,
  %aboveskip=8pt, belowskip=\parskip
}
\captionsetup[table]{% Table
  style=jazzcaptionstyle, position=top,% justification=justified,
  width=\linewidth,
  %aboveskip=\parskip, skip=8pt% belowskip=8pt
}
\captionsetup[video]{% Video
  style=jazzcaptionstyle, position=bottom,
  width=\linewidth,
  %aboveskip=8pt, belowskip=\parskip
}
\captionsetup[graphic]{% Graphic
  style=jazzcaptionbasicstyle, position=bottom,
  %style=jazzcaptionstyle, position=bottom,
  width=\linewidth,
  %aboveskip=8pt, belowskip=\parskip
}
%\captionsetup[code]{% Code
%  style=jazzcaptionstyle, position=top,% justification=justified,
%  width=\linewidth,
%  %aboveskip=\parskip, skip=8pt% belowskip=8pt
%}
%- For the time being, please do not use "listing" environment inside "exercise" environments:
%- the captions are not yet correctly implemented. Use "code" and "code*" environments.
%- However, you can use the "listingbox" environment as such.
%\captionsetup[listing]{% Listing − The listing environment is defined by the `minted' package
%  style=jazzcaptionstyle, position=top,% justification=justified,
%  width=\linewidth,
%  %aboveskip=\parskip, skip=8pt% belowskip=8pt
%}

%-- Commandes de mise en forme pour certains environnements flottants supplémentaires
%------------------------------------------------------------------------------------

%- wrapfig : options spécifiques
\captionsetup[wrapfigure]{format=plain, indention={1mm+.5em}}
\captionsetup[wraptable]{format=plain, indention={1mm+.5em}}
\captionsetup[wrapgraphic]{format=plain, indention={1mm+.5em}}
\captionsetup[wrapvideo]{format=plain, indention={1mm+.5em}}
\captionsetup[wrapcode]{format=plain, indention={1mm+.5em}}
%\captionsetup[wraplisting]{format=plain, indention={1mm+.5em}}
%\captionsetup[wrapfigure]{name=Fig., format=hang}%  wrapfig : options spécifiques
%\captionsetup[wrapfigure]{name=Fig.,format=plain}%  wrapfig : options spécifiques
%\captionsetup[wraptable]{name=Tab.}%  wrapfig : options spécifiques à cette extention
%\captionsetup[longtable]{}    %  longtable : options spécifiques à cette extention
%\captionsetup[figwindow]{}    %  picinpar : options spécifiques à cette extention
%\captionsetup[tabwindow]{}    %  picinpar : options spécifiques à cette extention
%\captionsetup[parpic]{}      %  picsin : options spécifiques à cette extention
%\captionsetup[SCfigure]{}    %  sidecap : options spécifiques à cette extention
%\captionsetup[SCtable]{}      %  sidecap : options spécifiques à cette extention

%----- Namely
%- Star version: \caption*{} typeset the caption without label and without entry in LoF or LoT
%-----
%\captionsetup*[SCtable]{style=jazzSideCaptionStyle, justification=raggedouter}
%\captionsetup*[SCfigure]{style=jazzSideCaptionStyle, justification=raggedouter}
%\captionsetup[SCtable]{style=jazzSideCaptionStyle, justification=raggedouter}
%\captionsetup[SCfigure]{style=jazzSideCaptionStyle, justification=raggedouter}
%\captionsetup*[figure]{style=jazzcaptionstyle, justification=RaggedRight, position=bottom}
%\captionsetup*[table]{style=jazzcaptionstyle, justification=RaggedRight, position=bottom}

%-- Gestion des figures multiples et des légendes / Multiple figures and captions management
%-------------------------------------------------------------------------------------------

%- Comptabilisation des subfigures et subtables dans LoF et LoT
\RequirePackage{subcaption}%

%- Configuration modifiable ensuite à l'intérieur d'un flottant particulier (cf. subcaption.sty)
\captionsetup[sub]{%
  font=footnotesize, textfont=it, justification=centering, hypcap=false, list=false,
  format=plain, width=\linewidth, labelformat=parens, labelsep=space}%

%-- Margin 'fake float' environment caption content in "List of..."
%------------------------------------------------------------------

\NewDocumentCommand{\sidecaption}{m m}{% side/margin caption
  % Syntax − #1 = type of content or fake "float"
  %          #2 = caption text
  \marginnote{%
    \ifstrequal{#1}{graphic}{%
      \captionsetup[#1]{
        style=jazzcaptionbasicstyle,
        font=footnotesize,
        width=\marginparwidth,
        list=false,
        aboveskip=0pt, belowskip=\parskip, skip=0pt,
      }%
    }{%
      \captionsetup[#1]{
        style=jazzcaptionstyle,
        font=footnotesize,
        width=\marginparwidth,
        format=plain,
        %list=false,
        aboveskip=0pt, belowskip=\parskip, skip=0pt,
      }%
    }%
    \captionof{#1}{#2}%
  }[-1.25\baselineskip]% Vertical offset: see above the \captionlayout definition
}

\newcommand{\sidecaptionlist}[2]{% See contents insert with 'caption.sty'
  % Syntax − #1 = env. name − #2 = caption for "list of #1"
  \addcontentsline{\csname ext@#1\endcsname}{#1}%
    {\protect\numberline{\csname the#1\endcsname}{\ignorespaces #2}}%
}

%-- Gestion des figures multiples et des légendes / Multiple figures and captions management
%-------------------------------------------------------------------------------------------

%- Comptabilisation des subfigures et subtables dans LoF et LoT
\RequirePackage{subcaption}%

%- Configuration modifiable ensuite à l'intérieur d'un flottant particulier (cf. subcaption.sty)
\captionsetup[sub]{%
  font=footnotesize, textfont=it, justification=centering, hypcap=false, list=false,
  format=plain, width=\linewidth, labelformat=parens, labelsep=space}%










