%%
%% texjazz-shell.def
%%
%% A LaTeX file to simulate and display terminal and Python consoles.
%%
%% Copyright (c) 2020-2021 ejazz.
%%
% --------------------------------------------------------------------------------------------------
% This work is part of the TeXjazz bundle. It may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% The Current Maintainer of this work is ejazz <ejazz.fr@gmail.com>.
%
% This work consists of the files:
%     `texjazz-shell.def' and `texjazz-shell[-fr].tex' (not yet fully available).
% --------------------------------------------------------------------------------------------------

%-- File identification
%----------------------

\ProvidesFile{texjazz-shell.def}
  [2021/02/08 v0.1a − Simulating and displaying terminal and Python consoles]

\newbool{shell@usefrenchlanguage}% To be extended for compliance with language packages
\booltrue{shell@usefrenchlanguage}%

%-- Document management
%----------------------

%- The "lightboldfont" comes from textjazz-handbook
\ifcsdef{lightboldfont}{}{\let\lightboldfont\bfseries}

%- The "shell@article" comes from textjazz-handbook "doc@article"
\newbool{shell@article}
\ifcsdef{chapter}{\boolfalse{shell@article}}{\booltrue{shell@article}}
\newbool{shell@appendixchapter}
\ifcsdef{appendixchapter}{\booltrue{shell@appendixchapter}}{\boolfalse{shell@appendixchapter}}

%-- LaTeX listings, commands and environments (language styles defined with `listings` package)
%--------------------------------------------

%\RequirePackage{listings}% Also loaded by the `tcolorbox' and `texjazz-coding` packages before

%- "Re-hook" literate char table
\lst@AddToHook{SelectCharTable}
    {\ifx\lst@literate\@empty\else
         \expandafter\lst@Literate\lst@literate{}\relax\z@
     \fi}


%-- Defining "shell" environment to simulate a terminal console (with `listings' package)
%----------------------------------------------------------------------------------------

\definecolor{shellusercolor}{RGB}{138, 226, 52}% HTML: #8AE234
\definecolor{shelldircolor}{RGB}{81, 135, 203}% HTML: #5187CB
\definecolor{shellbgcolor}{RGB}{55, 54, 51}% HTML: #373633
\definecolor{shelltitlebgcolor}{RGB}{63, 62, 58}% HTML: #3F3E3A

%- From: https://tex.stackexchange.com/questions/517976/[...]
%-          [...]drawing-realistic-linux-command-shell-windows-with-tcolorbox
%-       https://tex.stackexchange.com/questions/518202/tcbuselibrary-redefining-every-listing-line

%- SVG icons are into: /usr/share/themes/Ambiant-MATE/unity
%- Install SVG2TikZ: https://github.com/kjellmf/svg2tikz/blob/master/docs/install.rst

\newfontfamily{\shellfont}{Ubuntu-R.ttf}[
  Scale=0.95,
  %Numbers=Lining,
  %Ligatures=TeX,
  ItalicFont={Ubuntu-RI.ttf},
  BoldFont={Ubuntu-M.ttf},
  BoldItalicFont={Ubuntu-MI.ttf},
  ]

%\newfontfamily{\shellttfont}{UbuntuMono-R.ttf}[
\newfontfamily{\shellttfont}{UbuntuXMono-R.ttf}[
  %Scale=0.95,
  %Numbers=Lining,
  %Ligatures=TeX,
  ItalicFont={UbuntuMono-RI.ttf},
  BoldFont={UbuntuMono-B.ttf},
  BoldItalicFont={UbuntuMono-BI.ttf},
  ]

\lstdefinelanguage{shell}{%
  morekeywords={},% No emphasis of keywords at all: text
  morecomment=[l]\#,%
  morestring=[d]",%
  morestring=[d]'%
  }[keywords,comments,strings]%

\lstdefinestyle{shellstyle}{%
  basicstyle={\small\shellttfont},
  numbers=none, %frame=lines, backgroundcolor=\color{\@layoutcolor!2}, 
  aboveskip=0pt, belowskip=0pt,% default=\medskipamount
  columns=flexible,
  breaklines=true, 
  breakindent=0pt, 
  %breakatwhitespace=true,
}

%- From: https://tex.stackexchange.com/questions/517976/[...]
%-          [...]drawing-realistic-linux-command-shell-windows-with-tcolorbox
%-       https://tex.stackexchange.com/questions/518202/tcbuselibrary-redefining-every-listing-line

\NewTCBListing{ubuntu}{ O{Terminal} }{%
  enhanced, breakable, boxsep=0pt,
  top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
  left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
  toptitle=1pt, bottomtitle=1pt,
  boxrule=1.6pt,
  %colback=violet!50!black,
  colbacktitle=shelltitlebgcolor,
  coltitle=white,
  fonttitle=\shellfont,
  colback=shellbgcolor, 
  colupper=white, 
  fontupper=\shellttfont,
  %colframe=gray!65!black,
  colframe=shelltitlebgcolor,
  fuzzy halo=1.2pt with gray,
  sharp corners=south,
  before skip=4pt,
  after skip=4pt,
  listing only, 
  listing engine=listings,
  listing options={
    style=shellstyle,
    language=shell,
    escapeinside=§§,
  },
  title={%
    \ifbool{shell@usefrenchlanguage}{%
      \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-maximize.png}%
      \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
      \raisebox{3pt}{\footnotesize%
        Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
        Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
      }\vspace*{-2pt}%
    }{\hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-maximize.png}%
      \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
      \raisebox{3pt}{\footnotesize%
        File\hspace*{5pt}Edit\hspace*{5pt}View\hspace*{5pt}%
        Search\hspace*{5pt}Terminal\hspace*{5pt}Help%
      }\vspace*{-2pt}%
    }
  },
  every listing line={\shellprompt}
}

\pgfkeys{%
  /ubuntu/.cd,
  shuser/.code={\gdef\shelluser{#1}},
  shuser={},
  shhost/.code={\gdef\shellhost{#1}},
  shhost={},
  shcolor/.code={\gdef\shellcolor{#1}},
  shcolor=shellusercolor,
  shprompt char/.code={\gdef\shellpromptchar{#1}},
  shprompt char=\$,
  shdirectory/.code={\gdef\shelldirectory{#1}},
  shdirectory=\char`~,
  root/.style={shuser=root, shhost=host, shcolor=white, shprompt char=\#},
  user/.style={shuser=user, shhost=host, shcolor=shellusercolor, shprompt char=\$},
}

\newcommand{\shmult}{\raisebox{0.2ex}{*}}

\newcommand{\setuser}[1]{% `su' Unix command stands for `substitute user'
  \pgfkeys{/ubuntu/.cd, #1}%
  \ifbool{shell@usefrenchlanguage}{%
    \gdef\shellprompt{%
      \textcolor{\shellcolor}{%
        \small\shellttfont\shelluser{@}\shellhost{\NoAutoSpacing\color{white}:}%
        {\color{shelldircolor}\shelldirectory}{\color{white}\shellpromptchar} }%
    }%
  }{\gdef\shellprompt{%
      \textcolor{\shellcolor}{%
        \small\shellttfont\shelluser{@}\shellhost{\color{white}:}%
        {\color{shelldircolor}\shelldirectory}{\color{white}\shellpromptchar} }%
    }%
  }
}

\newcommand{\startconsole}{\gdef\shellprompt{}}

\ifbool{@twoside}{%
  \NewTCBListing{ubuntu*}{ O{Terminal} }{%
    enhanced, breakable, 
    check odd page, 
    toggle left and right, 
    grow to right by=\marginparwidth+\marginparsep, 
    toggle enlargement=evenpage, 
    notitle after break,
    boxsep=0pt,
    top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
    left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
    toptitle=1pt, bottomtitle=1pt,
    boxrule=1.6pt,
    %colback=violet!50!black,
    colbacktitle=shelltitlebgcolor,
    coltitle=white,
    fonttitle=\shellfont,
    colback=shellbgcolor, 
    colupper=white, 
    fontupper=\shellttfont,
    %colframe=gray!65!black,
    colframe=shelltitlebgcolor,
    fuzzy halo=1.2pt with gray,
    sharp corners=south,
    before skip=4pt,
    after skip=4pt,
    listing only, 
    listing engine=listings,
    listing options={
      style=shellstyle,
      language=shell,
      escapeinside=§§,
    },
    title={%
      \ifbool{shell@usefrenchlanguage}{%
        \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-maximize.png}%
        \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
        \raisebox{3pt}{\footnotesize%
          Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
          Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
        }\vspace*{-2pt}%
      }{\hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-maximize.png}%
        \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
        \raisebox{3pt}{\footnotesize%
          File\hspace*{5pt}Edit\hspace*{5pt}View\hspace*{5pt}%
          Search\hspace*{5pt}Terminal\hspace*{5pt}Help%
        }\vspace*{-2pt}%
      }
    },
    every listing line={\shellprompt}
  }
}{\ifbool{@reversemargin}{%
    \NewTCBListing{ubuntu*}{ O{Terminal} }{%
      enhanced, breakable, 
      check odd page,
      toggle left and right, 
      grow to right by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      boxsep=0pt,
      top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
      left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
      toptitle=1pt, bottomtitle=1pt,
      boxrule=1.6pt,
      %colback=violet!50!black,
      colbacktitle=shelltitlebgcolor,
      coltitle=white,
      fonttitle=\shellfont,
      colback=shellbgcolor, 
      colupper=white, 
      fontupper=\shellttfont,
      %colframe=gray!65!black,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners=south,
      before skip=4pt,
      after skip=4pt,
      listing only, 
      listing engine=listings,
      listing options={
        style=shellstyle,
        language=shell,
        escapeinside=§§,
      },
      title={%
        \ifbool{shell@usefrenchlanguage}{%
          \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-maximize.png}%
          \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
          \raisebox{3pt}{\footnotesize%
            Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
            Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
          }\vspace*{-2pt}%
        }{\hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-maximize.png}%
          \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
          \raisebox{3pt}{\footnotesize%
            File\hspace*{5pt}Edit\hspace*{5pt}View\hspace*{5pt}%
            Search\hspace*{5pt}Terminal\hspace*{5pt}Help%
          }\vspace*{-2pt}%
        }
      },
      every listing line={\shellprompt}
    }
  }{\NewTCBListing{ubuntu*}{ O{Terminal} }{%
      enhanced, breakable, 
      check odd page, 
      lowerbox=ignored,
      grow to left by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      boxsep=0pt,
      top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
      left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
      toptitle=1pt, bottomtitle=1pt,
      boxrule=1.6pt,
      %colback=violet!50!black,
      colbacktitle=shelltitlebgcolor,
      coltitle=white,
      fonttitle=\shellfont,
      colback=shellbgcolor, 
      colupper=white, 
      fontupper=\shellttfont,
      %colframe=gray!65!black,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners=south,
      before skip=4pt,
      after skip=4pt,
      listing only, 
      listing engine=listings,
      listing options={
        style=shellstyle,
        language=shell,
        escapeinside=§§,
      },
      title={%
        \ifbool{shell@usefrenchlanguage}{%
          \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-maximize.png}%
          \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
          \raisebox{3pt}{\footnotesize%
            Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
            Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
          }\vspace*{-2pt}%
        }{\hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
          \includegraphics[scale=0.2]{ubuntu-maximize.png}%
          \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
          \raisebox{3pt}{\footnotesize%
            File\hspace*{5pt}Edit\hspace*{5pt}View\hspace*{5pt}%
            Search\hspace*{5pt}Terminal\hspace*{5pt}Help%
          }\vspace*{-2pt}%
        }
      },
      every listing line={\shellprompt}
    }
  }
}


%-- Defining "ipython" environment to simulate a terminal console (with `listings' package)
%------------------------------------------------------------------------------------------

\definecolor{ipythonkeywordcolor}{RGB}{1, 135, 0}% HTML: #018700
\definecolor{ipythonpromptincolor}{RGB}{1, 135, 0}% HTML: #018700
\definecolor{ipythonpromptinlinecolor}{RGB}{138, 226, 52}% HTML: #8AE234
\definecolor{ipythonpromptoutcolor}{RGB}{126, 1, 0}% HTML: #7E0100
\definecolor{ipythonpromptoutlinecolor}{RGB}{239, 41, 41}% HTML: #EF2929

\lstdefinelanguage{ipython}{%
  morekeywords={access, and, break, class, continue, def, del, elif, else,%
    except, exec, finally, for, from, global, if, import, in, is, lambda,%
    not, or, pass, print, raise, return, try, while},%
  % Built-ins
  morekeywords=[2]{abs, all, any, basestring, bin, bool, bytearray,%
    callable, chr, classmethod, cmp, compile, complex, delattr, dict, dir,%
    divmod, enumerate, eval, execfile, file, filter, float, format,%
    frozenset, getattr, globals, hasattr, hash, help, hex, id, input, int,%
    isinstance, issubclass, iter, len, list, locals, long, map, max,%
    memoryview, min, next, object, oct, open, ord, pow, property, range,%
    raw_input, reduce, reload, repr, reversed, round, set, setattr, slice,%
    sorted, staticmethod, str, sum, super, tuple, type, unichr, unicode,%
    vars, xrange, zip, apply, buffer, coerce, intern},%
  sensitive=true,%
  morecomment=[l]\#,%
  morestring=[b]',%
  morestring=[b]",%
  morecomment=[s]{'''}{'''},% used for documentation text
                            % (mulitiline strings)
  morecomment=[s]{"""}{"""},% added by Philipp Matthias Hahn
  morestring=[s]{r'}{'},% `raw' strings
  morestring=[s]{r"}{"},%
  morestring=[s]{r'''}{'''},%
  morestring=[s]{r"""}{"""},%
  morestring=[s]{u'}{'},% unicode strings
  morestring=[s]{u"}{"},%
  morestring=[s]{u'''}{'''},%
  morestring=[s]{u"""}{"""}%
}%

\lstdefinestyle{ipythonstyle}{%
  basicstyle={\small\shellttfont},
  numbers=none,
  aboveskip=0pt, belowskip=0pt,% default=\medskipamount
  columns=flexible,
  breaklines=true, 
  breakindent=0pt, 
  %breakatwhitespace=true,
  keywordstyle={\color{red}\bfseries},
  stringstyle=\color{blue},
  identifierstyle=\color{green},
}

\NewTCBListing{ipythonshell}{ O{Terminal} }{%
  enhanced, breakable, boxsep=0pt,
  top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
  left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
  toptitle=1pt, bottomtitle=1pt,
  boxrule=1.6pt,
  colbacktitle=shelltitlebgcolor,
  coltitle=white,
  fonttitle=\shellfont,
  colback=shellbgcolor, 
  colupper=white, 
  fontupper=\shellttfont,
  %colframe=gray!65!black,
  colframe=shelltitlebgcolor,
  fuzzy halo=1.2pt with gray,
  sharp corners=south,
  before skip=4pt,
  after skip=4pt,
  listing only, 
  listing engine=minted,
  minted style=ipythonjazz,
  minted language=ipython3,
  minted options={
    fontsize=\small,
    breaklines,
    autogobble,
    tabsize=2,
    escapeinside=§§,
    texcomments,
  },
  title={%
    \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-maximize.png}%
    \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
    \raisebox{3pt}{\footnotesize%
      Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
      Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
    }\vspace*{-2pt}%
  },
  %every listing line={\shellprompt}
}

\newcommand{\ipythonuserprompt}[4]{%
  \textcolor{white}{%
    \small\shellttfont{\color{shellusercolor}#1@#2}{\NoAutoSpacing\color{white}:}%
    {\color{shelldircolor}#3}{\color{white}#4} }%
}

\newcommand{\ipythontext}[1]{\textcolor{white}{\small\shellttfont #1}}

\newcommand{\ipythonpromptin}[1]{%
  \textcolor{ipythonpromptincolor}{%
    \small\shellttfont In [\textcolor{ipythonpromptinlinecolor}{#1}]:}%
}

\newcommand{\ipythonpromptdots}{%
  \textcolor{ipythonkeywordcolor}{\small\shellttfont\hphantom{In} ...{:}}%
}

\newcommand{\ipythonpromptout}[1]{%
  \textcolor{ipythonpromptoutcolor}{%
    \small\shellttfont Out[\textcolor{ipythonpromptoutlinecolor}{#1}]:}%
}

\ifbool{@twoside}{%
  \NewTCBListing{ipythonshell*}{ O{Terminal} }{%
    enhanced, breakable, boxsep=0pt,
    check odd page, 
    toggle left and right, 
    grow to right by=\marginparwidth+\marginparsep, 
    toggle enlargement=evenpage, 
    notitle after break,
    top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
    left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
    toptitle=1pt, bottomtitle=1pt,
    boxrule=1.6pt,
    colbacktitle=shelltitlebgcolor,
    coltitle=white,
    fonttitle=\shellfont,
    colback=shellbgcolor, 
    colupper=white, 
    fontupper=\shellttfont,
    %colframe=gray!65!black,
    colframe=shelltitlebgcolor,
    fuzzy halo=1.2pt with gray,
    sharp corners=south,
    before skip=4pt,
    after skip=4pt,
    listing only, 
    listing engine=minted,
    minted style=ipythonjazz,
    minted language=ipython3,
    minted options={
      fontsize=\small,
      breaklines,
      autogobble,
      tabsize=2,
      escapeinside=§§,
      texcomments,
    },
    title={%
      \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-maximize.png}%
      \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
      \raisebox{3pt}{\footnotesize%
        Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
        Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
      }\vspace*{-2pt}%
    },
    %every listing line={\shellprompt}
  }
}{\ifbool{@reversemargin}{%
    \NewTCBListing{ipythonshell*}{ O{Terminal} }{%
      enhanced, breakable, boxsep=0pt,
      check odd page,
      toggle left and right, 
      grow to right by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
      left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
      toptitle=1pt, bottomtitle=1pt,
      boxrule=1.6pt,
      colbacktitle=shelltitlebgcolor,
      coltitle=white,
      fonttitle=\shellfont,
      colback=shellbgcolor, 
      colupper=white, 
      fontupper=\shellttfont,
      %colframe=gray!65!black,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners=south,
      before skip=4pt,
      after skip=4pt,
      listing only, 
      listing engine=minted,
      minted style=ipythonjazz,
      minted language=ipython3,
      minted options={
        fontsize=\small,
        breaklines,
        autogobble,
        tabsize=2,
        escapeinside=§§,
        texcomments,
      },
      title={%
        \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-maximize.png}%
        \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
        \raisebox{3pt}{\footnotesize%
          Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
          Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
        }\vspace*{-2pt}%
      },
      %every listing line={\shellprompt}
    }   
  }{\NewTCBListing{ipythonshell*}{ O{Terminal} }{%
      enhanced, breakable, boxsep=0pt,
      check odd page, 
      lowerbox=ignored,
      grow to left by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
      left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
      toptitle=1pt, bottomtitle=1pt,
      boxrule=1.6pt,
      colbacktitle=shelltitlebgcolor,
      coltitle=white,
      fonttitle=\shellfont,
      colback=shellbgcolor, 
      colupper=white, 
      fontupper=\shellttfont,
      %colframe=gray!65!black,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners=south,
      before skip=4pt,
      after skip=4pt,
      listing only, 
      listing engine=minted,
      minted style=ipythonjazz,
      minted language=ipython3,
      minted options={
        fontsize=\small,
        breaklines,
        autogobble,
        tabsize=2,
        escapeinside=§§,
        texcomments,
      },
      title={%
        \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-maximize.png}%
        \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
        \raisebox{3pt}{\footnotesize%
          Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
          Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
        }\vspace*{-2pt}%
      },
      %every listing line={\shellprompt}
    }   
  }
}

\NewTCBListing{ipythonminted}{ O{Terminal} }{%
  enhanced, breakable, boxsep=0pt,
  top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
  left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
  toptitle=1pt, bottomtitle=1pt,
  boxrule=1.6pt,
  colbacktitle=shelltitlebgcolor,
  coltitle=white,
  fonttitle=\shellfont,
  colback=shellbgcolor, 
  colupper=white, 
  fontupper=\shellttfont,
  %colframe=gray!65!black,
  colframe=shelltitlebgcolor,
  fuzzy halo=1.2pt with gray,
  sharp corners=south,
  before skip=4pt,
  after skip=4pt,
  listing only, 
  listing engine=minted,
  minted style=ipythonjazz,
  minted language=ipython3,
  minted options={
    fontsize=\small,
    breaklines,
    autogobble,
    tabsize=2,
    escapeinside=§§,
    texcomments,
  },
  title={%
    \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-maximize.png}%
    \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
    \raisebox{3pt}{\footnotesize%
      Fichier\hspace*{5pt}Éditer\hspace*{5pt}Affichage\hspace*{5pt}%
      Rechercher\hspace*{5pt}Terminal\hspace*{5pt}Aide%
    }\vspace*{-2pt}%
  },
  %every listing line={\shellprompt}
}

%-- Defining "notebook In[]" environment to simulate a Jupyter notebook code cell
%--------------------------------------------------------------------------------

\definecolor{pynbcodeinbgcolor}{RGB}{225, 223, 220}% HTML: #e1dfdc
\definecolor{pynbcodefalsebgcolor}{RGB}{235, 207, 207}% HTML: #ebcfcf
\definecolor{pynbcodetruebgcolor}{RGB}{206, 230, 197}% HTML: #cee6c5

\NewTCBListing{nbjupyterin}{ o m }{%
  enhanced, breakable, boxsep=0pt,
  top=2pt, bottom=1pt,% middle = 2pt,% additional to boxsep
  left=2pt, right=2pt, arc=0pt,% Default: arc=1mm
  boxrule=0.2pt,
  colback=pynbcodeinbgcolor, 
  %colupper=white, 
  %fontupper=\shellttfont,
  fontupper=\ttfamily,
  colframe=gray,
  sharp corners,
  before skip=1pt,
  after skip=1pt,
  width=\linewidth,
  notitle,
  listing only, 
  listing engine=minted,
  minted style=python,
  minted language=python,
  minted options={
    fontsize=\small,
    breaklines,
    autogobble,
    tabsize=2,
    escapeinside=§§,
    %formatcom=\bashprompt,
  },
  underlay={%
    \begin{tcbinvclipframe}
      \node[anchor=east, xshift=-4pt, yshift=(-.5\baselineskip-1pt)]
        at (frame.north west) {\textcolor{firstcolor}{\texttt{In[#2]}}};%
    \end{tcbinvclipframe}
  },
  IfValueTF={#1}{#1}{},
}

%\NewTCBListing{nbipythonout}{ o m }{%nbcodeoutjupyter
\NewTCBListing{nbjupyterout}{ o m }{%nbcodeoutjupyter
  enhanced, breakable, boxsep=0pt,
  top=2pt, bottom=1pt,% middle = 2pt,% additional to boxsep
  left=2pt, right=2pt, arc=0pt,% Default: arc=1mm
  boxrule=0.0pt,
  colback=white, 
  %colupper=white, 
  fontupper=\shellttfont,
  colframe=white,
  sharp corners,
  before skip=1pt,
  after skip=1pt,
  width=\linewidth,
  notitle,
  listing only, 
  listing engine=minted,
  minted style=python,
  minted language=python,
  minted options={
    fontsize=\small,
    breaklines,
    autogobble,
    tabsize=2,
    escapeinside=§§,
    %formatcom=\bashprompt,
  },
  underlay={%
    \begin{tcbinvclipframe}
      \node[anchor=east, xshift=-4pt, yshift=(-.5\baselineskip-1pt)]
        at (frame.north west) {\textcolor{secondcolor}{\texttt{Out[#2]}}};%
    \end{tcbinvclipframe}
  },
  IfValueTF={#1}{#1}{},
}

%-- Defining "idle" environment to simulate a interpretor console (with `listings' package)
%------------------------------------------------------------------------------------------

%- From: https://tex.stackexchange.com/questions/269928/[...]
%-          [...]formatting-certain-texts-in-fancyvrb-environments-automatically/

\input{listings-python.prf}% Implemented separately (to be known!)

%\lstset{
\lstdefinestyle{idlestyle}{%
  style=python-idle-code,
  basicstyle={\small\shellttfont},
  numbers=none,
  aboveskip=0pt, belowskip=0pt,% default=\medskipamount
  columns=flexible,
  breaklines=true, 
  breakindent=0pt, 
  %breakatwhitespace=true,
  showstringspaces=false,  % true by default for python
  tabsize=2,
  %otherkeywords={>>>},    % used only because >>> is not an identifier
  %morekeywords=[3]{>>>},
  %keywordstyle={[3]\color{blue}},
}

% Blue prompts 
%\lstset{
%  otherkeywords={>>>},    % used only because >>> is not an identifier
%  morekeywords=[3]{>>>},
%  keywordstyle={[3]\color{blue}},
%}

\NewTCBListing{idle}{ O{Python 3.8.2 Shell} }{%
  enhanced, breakable, boxsep=0pt,
  top=1pt, bottom=1pt,% middle = 2pt,% additional to boxsep
  left=1pt, right=1pt, arc=2pt,% Default: arc=1mm
  toptitle=1pt, bottomtitle=1pt,
  boxrule=1.6pt,
  %colback=violet!50!black,
  colbacktitle=shelltitlebgcolor,
  coltitle=white,
  fonttitle=\shellfont,
  %colback=shellbgcolor, 
  %colupper=white, 
  fontupper=\shellttfont,
  %colframe=gray!65!black,
  colframe=shelltitlebgcolor,
  fuzzy halo=1.2pt with gray,
  sharp corners=south,
  before skip=2pt,
  after skip=2pt,
  listing only, 
  listing engine=listings,
  listing options={
    style=idlestyle,
    language=python,
    escapeinside=§§,
  },
  title={%
    \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-maximize.png}%
    \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#1}\newline%
    \raisebox{3pt}{\footnotesize%
      File\hspace*{5pt}Edit\hspace*{5pt}Shell\hspace*{5pt}%
      Debug\hspace*{5pt}Options\hspace*{5pt}Window\hspace*{5pt}Help%
    }\vspace*{-2pt}%
  },
  %every listing line={\shellprompt}
}

\definecolor{idleshellbgcolor}{RGB}{248, 248, 248}% HTML: #f8f8f8 (see Pygments)
\definecolor{idleshellbgmenu}{RGB}{242, 241, 240}% HTML: #f2f1f0
\definecolor{idleoutputcolor}{RGB}{0, 0, 207}% HTML: #0000cf
\definecolor{idleerrorcolor}{RGB}{255, 0, 0}% HTML: #ff0806 (pure red)

\NewTColorBox{idleshell}{ o G{Python 3.8.2 Shell} }{% To surround "pyconsole" environment
  enhanced, breakable, boxsep=0pt,
  top=16pt, bottom=4pt,% middle = 2pt,% additional to boxsep
  left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
  toptitle=1pt, bottomtitle=1pt,
  boxrule=0.8pt,
  %colback=violet!50!black,
  colbacktitle=shelltitlebgcolor,
  coltitle=white,
  fonttitle=\shellfont,
  colback=idleshellbgcolor, 
  colupper=black, 
  fontupper=\small\shellttfont,
  colframe=shelltitlebgcolor,
  fuzzy halo=1.2pt with gray,
  sharp corners=south,
  lowerbox=ignored,
  before skip=6pt,
  after skip=6pt,
  attach boxed title to top,
  title={%
    \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
    \includegraphics[scale=0.2]{ubuntu-maximize.png}%
    \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#2}%\newline%
  },
  boxed title style={%
    colback=shelltitlebgcolor,
    interior code={%
      \path[draw=gray, line width=1.2pt, fill=idleshellbgmenu] 
        (interior.south west) rectangle ([yshift=-12pt]interior.south east);
      \node[anchor=west, font=\footnotesize\shellfont] 
        at ([xshift=0.5pt, yshift=-6pt]interior.south west) {%
          \uline{F}ile\hspace*{5pt}\uline{E}dit\hspace*{5pt}\uline{S}hell\hspace*{5pt}%
          \uline{D}ebug\hspace*{5pt}\uline{O}ptions\hspace*{5pt}\uline{W}indow\hspace*{5pt}%
          \uline{H}elp%
      };
    },
  },
  IfValueTF={#1}{#1}{}
}

\ifbool{@twoside}{%
  \NewTColorBox{idleshell*}{ o G{Python 3.8.2 Shell} }{% To surround "pyconsole" environment (full width)
    enhanced, breakable, 
    check odd page, 
    toggle left and right, 
    grow to right by=\marginparwidth+\marginparsep, 
    toggle enlargement=evenpage, 
    notitle after break,
    boxsep=0pt,
    top=16pt, bottom=4pt,% middle = 2pt,% additional to boxsep
    left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
    toptitle=1pt, bottomtitle=1pt,
    boxrule=0.8pt,
    %colback=violet!50!black,
    colbacktitle=shelltitlebgcolor,
    coltitle=white,
    fonttitle=\shellfont,
    colback=idleshellbgcolor, 
    colupper=black, 
    fontupper=\small\shellttfont,
    colframe=shelltitlebgcolor,
    fuzzy halo=1.2pt with gray,
    sharp corners=south,
    lowerbox=ignored,
    before skip=6pt,
    after skip=6pt,
    attach boxed title to top,
    title={%
      \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
      \includegraphics[scale=0.2]{ubuntu-maximize.png}%
      \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#2}%\newline%
    },
    boxed title style={%
      colback=shelltitlebgcolor,
      interior code={%
        \path[draw=gray, line width=1.2pt, fill=idleshellbgmenu] 
          (interior.south west) rectangle ([yshift=-12pt]interior.south east);
        \node[anchor=west, font=\footnotesize\shellfont] 
          at ([xshift=0.5pt, yshift=-6pt]interior.south west) {%
            \uline{F}ile\hspace*{5pt}\uline{E}dit\hspace*{5pt}\uline{S}hell\hspace*{5pt}%
            \uline{D}ebug\hspace*{5pt}\uline{O}ptions\hspace*{5pt}\uline{W}indow\hspace*{5pt}%
            \uline{H}elp%
        };
      },
    },
    IfValueTF={#1}{#1}{}
  }
}{\ifbool{@reversemargin}{%
   \NewTColorBox{idleshell*}{ o G{Python 3.8.2 Shell} }{% To surround "pyconsole" environment (full width)
      enhanced, breakable, 
      check odd page,
      toggle left and right, 
      grow to right by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      boxsep=0pt,
      top=16pt, bottom=4pt,% middle = 2pt,% additional to boxsep
      left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
      toptitle=1pt, bottomtitle=1pt,
      boxrule=0.8pt,
      %colback=violet!50!black,
      colbacktitle=shelltitlebgcolor,
      coltitle=white,
      fonttitle=\shellfont,
      colback=idleshellbgcolor, 
      colupper=black, 
      fontupper=\small\shellttfont,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners=south,
      lowerbox=ignored,
      before skip=6pt,
      after skip=6pt,
      attach boxed title to top,
      title={%
        \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-maximize.png}%
        \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#2}%\newline%
      },
      boxed title style={%
        colback=shelltitlebgcolor,
        interior code={%
          \path[draw=gray, line width=1.2pt, fill=idleshellbgmenu] 
            (interior.south west) rectangle ([yshift=-12pt]interior.south east);
          \node[anchor=west, font=\footnotesize\shellfont] 
            at ([xshift=0.5pt, yshift=-6pt]interior.south west) {%
              \uline{F}ile\hspace*{5pt}\uline{E}dit\hspace*{5pt}\uline{S}hell\hspace*{5pt}%
              \uline{D}ebug\hspace*{5pt}\uline{O}ptions\hspace*{5pt}\uline{W}indow\hspace*{5pt}%
              \uline{H}elp%
          };
        },
      },
      IfValueTF={#1}{#1}{}
    }
  }{\NewTColorBox{idleshell*}{ o G{Python 3.8.2 Shell} }{% To surround "pyconsole" environment (full width)
      enhanced, breakable, 
      check odd page, 
      lowerbox=ignored,
      grow to left by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      boxsep=0pt,
      top=16pt, bottom=4pt,% middle = 2pt,% additional to boxsep
      left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
      toptitle=1pt, bottomtitle=1pt,
      boxrule=0.8pt,
      %colback=violet!50!black,
      colbacktitle=shelltitlebgcolor,
      coltitle=white,
      fonttitle=\shellfont,
      colback=idleshellbgcolor, 
      colupper=black, 
      fontupper=\small\shellttfont,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners=south,
      lowerbox=ignored,
      before skip=6pt,
      after skip=6pt,
      attach boxed title to top,
      title={%
        \hspace*{1.5pt}\includegraphics[scale=0.2]{ubuntu-close.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-minimize.png}\hspace*{1.5pt}%
        \includegraphics[scale=0.2]{ubuntu-maximize.png}%
        \hspace*{4pt}\raisebox{1.5pt}{\footnotesize#2}%\newline%
      },
      boxed title style={%
        colback=shelltitlebgcolor,
        interior code={%
          \path[draw=gray, line width=1.2pt, fill=idleshellbgmenu] 
            (interior.south west) rectangle ([yshift=-12pt]interior.south east);
          \node[anchor=west, font=\footnotesize\shellfont] 
            at ([xshift=0.5pt, yshift=-6pt]interior.south west) {%
              \uline{F}ile\hspace*{5pt}\uline{E}dit\hspace*{5pt}\uline{S}hell\hspace*{5pt}%
              \uline{D}ebug\hspace*{5pt}\uline{O}ptions\hspace*{5pt}\uline{W}indow\hspace*{5pt}%
              \uline{H}elp%
          };
        },
      },
      IfValueTF={#1}{#1}{}
    }
  }
}

\NewTColorBox{idleconsole}{ o }{% To surround "pyconsole" environment
  enhanced, breakable, boxsep=0pt,
  top=4pt, bottom=4pt,% middle = 2pt,% additional to boxsep
  left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
  boxrule=0.8pt,
  colback=idleshellbgcolor, 
  colupper=black, 
  fontupper=\small\shellttfont,
  colframe=shelltitlebgcolor,
  fuzzy halo=1.2pt with gray,
  sharp corners,
  lowerbox=ignored,
  before skip=6pt,
  after skip=6pt,
  notitle,
  IfValueTF={#1}{#1}{},
}

\ifbool{@twoside}{%
  \NewTColorBox{idleconsole*}{ o }{% To surround "pyconsole" environment → fullwidth
    enhanced, breakable, 
    check odd page, 
    toggle left and right, 
    grow to right by=\marginparwidth+\marginparsep, 
    toggle enlargement=evenpage, 
    notitle after break,
    boxsep=0pt,
    top=4pt, bottom=4pt,% middle = 2pt,% additional to boxsep
    left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
    boxrule=0.8pt,
    colback=idleshellbgcolor, 
    colupper=black, 
    fontupper=\small\shellttfont,
    colframe=shelltitlebgcolor,
    fuzzy halo=1.2pt with gray,
    sharp corners,
    lowerbox=ignored,
    before skip=6pt,
    after skip=6pt,
    notitle,
    IfValueTF={#1}{#1}{},
  }
}{\ifbool{@reversemargin}{%
    \NewTColorBox{idleconsole*}{ o }{% To surround "pyconsole" environment → fullwidth
      enhanced, breakable, 
      check odd page,
      toggle left and right, 
      grow to right by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      boxsep=0pt,
      top=4pt, bottom=4pt,% middle = 2pt,% additional to boxsep
      left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
      boxrule=0.8pt,
      colback=idleshellbgcolor, 
      colupper=black, 
      fontupper=\small\shellttfont,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners,
      lowerbox=ignored,
      before skip=6pt,
      after skip=6pt,
      notitle,
      IfValueTF={#1}{#1}{},
    }
  }{\NewTColorBox{idleconsole*}{ o }{% To surround "pyconsole" environment → fullwidth
      enhanced, breakable, 
      check odd page,
      toggle left and right, 
      grow to right by=\marginparwidth+\marginparsep, 
      toggle enlargement=forced, 
      notitle after break,
      boxsep=0pt,
      top=4pt, bottom=4pt,% middle = 2pt,% additional to boxsep
      left=2pt, right=2pt, arc=2pt,% Default: arc=1mm
      boxrule=0.8pt,
      colback=idleshellbgcolor, 
      colupper=black, 
      fontupper=\small\shellttfont,
      colframe=shelltitlebgcolor,
      fuzzy halo=1.2pt with gray,
      sharp corners,
      lowerbox=ignored,
      before skip=6pt,
      after skip=6pt,
      notitle,
      IfValueTF={#1}{#1}{},
    }
  }
}

\endinput









