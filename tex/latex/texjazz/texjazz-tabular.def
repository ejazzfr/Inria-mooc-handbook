%%
%% texjazz-tabular.def
%%
%% A LaTeX file to configure tabulars.
%%
%% Copyright (c) 2020-2021 ejazz.
%%
% --------------------------------------------------------------------------------------------------
% This work is part of the TeXjazz bundle. It may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% The Current Maintainer of this work is ejazz <ejazz.fr@gmail.com>.
%
% This work consists of the files:
%     `texjazz-tabular.def' and `texjazz-tabular[-fr].tex' (not yet fully available).
% --------------------------------------------------------------------------------------------------

%-- File identification
%----------------------

\ProvidesFile{texjazz-tabular.def}%
  [2021/02/08 v0.1a − Configuring tabular environments]

%-- New implementation of LaTeX's tabular and array
\RequirePackage{array}% Mainly extending the control of columns (loaded by `colortbl' below)

%- Adding extra-height to the normal height of every row of the table (depth unchanged)
%\setlength{\extrarowheight}{1pt}% TODO: understanding the effects
%- Ajout global à la hauteur des lignes
%\renewcommand*{\arraystretch}{1.2}% stretch vertical heigth of lines

%-- New colum types shortcuts
\newcolumntype{=}{>{\global\let\currentrowstyle\relax}}
\newcolumntype{^}{>{\currentrowstyle}}
%\newcolumntype{=}{>{\rule[-2mm]{0pt}{4mm}\global\let\currentrowstyle\relax}}
%\newcolumntype{^}{>{\rule[-2mm]{0pt}{4mm}\currentrowstyle}}
\newcommand{\rowfontstyle}[1]{\gdef\currentrowstyle{#1}%
  #1\ignorespaces
}

%-- Others tabular extensions

\RequirePackage{tabularx}% extending tabular* for modifying certain width column
%\RequirePackage{delarray}% surrounding an array (math) with delimiters: parentheses, braces, etc.
\RequirePackage{xltabular}% Extend tabularx to pagebreaking the tabularx env.

%- New column type to center the values
%- http://tex.stackexchange.com/questions/89166/centering-in-tabularx-and-x-columns
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcolumntype{Z}{>{\leavevmode\color{white}\columncolor{maincolor}}X}
%\newcolumntype{W}{>{\color{white}\columncolor{darkelectricblue}}c}% ALREADY DEFINED!! WHERE?

%- From: https://tex.stackexchange.com/questions/104544/vertically-center-text-in-tabularx-table
%\renewcommand\tabularxcolumn[1]{m{#1}}% for vertical centering text in X column

%-- Rotating side text column
\newsavebox{\tabularx@sideways@box}
\newenvironment{tabularxsideways}
  {\begin{lrbox}{\tabularx@sideways@box}}
  {\end{lrbox}\rotatebox[origin=c]{90}{\usebox{\tabularx@sideways@box}}}
\newcolumntype{R}{>{\begin{tabularxsideways}}c<{\end{tabularxsideways}}}

%-- Experimental table extensions (not traditional)

%\RequirePackage{ctable}% TODO: try and test

%-- Add colors to LaTeX tables: coloringrows, columns, and cells within table (minimally lines)

\RequirePackage{colortbl}% already loaded by the `xcolor' package option `table'

%- Commands: \columncolor[color-model]{color}[left-overhang][right-overhang]
%-          + \newcolumntype{name} + \rowcolor[color]{percentage-(ex:.75)}
%-          + \arrayrulecolor{color} + \doublerulesepcolor{color}
%- Table option: \rowcolors[commands]{row}{odd-row-color}{even-row-color} (before a table start)
%-
%- Colored lines: set color of ALL horizontal and vertical rules
%\arrayrulecolor{red}
%- New command to set rowfont without the `tabu' package
%\newcommand{\myrowfonttype}{}% Current row font
%\newcommand{\myrowfont}[1]{% Set current row font
%   \gdef\myrowfonttype{#1}#1%
%}
%\newcolumntype{L}{>{\myrowfonttype}l}
%\newcommand\setrowfont[1]{\noalign{\gdef\jazzrowfont{#1}}}
%\gdef\jazzrowfont{}
%- Il semble y avoir un problème entre \rowcolor(s) et \tabcolsep, voir :
%- http://tex.stackexchange.com/questions/35170/colortbl-rowcolor-in-tables-with-begintabularccc
%- http://tex.stackexchange.com/questions/262375/rowcolors-when-space-is-removed-with @{}
%- http://tex.stackexchange.com/questions/292503/remove-space-between-columns-in-longtabu-with-rowcolors
%- http://tex.stackexchange.com/questions/266255/table-with-multirow-and-rowcolors
%- http://tex.stackexchange.com/questions/294579/why-does-rowcolors-cut-matrix-delimiter
%- Solutions :
%- \newcolumntype{C}{c<{\kern\tabcolsep}@{}} + \begin{tabular}{@{}CCc@{}}
%- \begin{tabular}{@{}>{\columncolor{white}[0pt][\tabcolsep]}lll>{\columncolor{white}[\tabcolsep][0pt]}l@{}}

%-- Tableau étendu sur plusieurs pages / Multi-page version of tabular

\RequirePackage{longtable}% longtable environment

%- \rowcolors{<start-number>}{<color-odd-line>}{<color-even-line>} doesn't work properly with
%- the `longtable' package. Some adjustments have to be done (Heiko Oberdiek) see the link below
%- Usage: cf. http://tex.stackexchange.com/questions/170637/restarting-rowcolors
%- "To some degree the "resetting" is working, if it is done in the previous row. However the first
%- row should be white not lightgray according to \rowcolors and the row numbering is not working correctly.
%\@ifundefined{c@rownum}{%
%  \let\c@rownum\rownum
%}{}
%\@ifundefined{therownum}{%
%  \def\therownum{\@arabic\rownum}%
%}{}
%\newcommand*{\restartrowcolors}{%
%  \ifhmode\unskip\fi
%  \vadjust{\global\rownum=0}%
%}

\RequirePackage{ltxtable}% longtable environment for using with the `tabularx' package
%\RequirePackage{ltablex}% Extending the `tabularx' package environment to longtable
                         % Ça fout le bouzin sur les légendes et la numérotation, donc à oublier
%\RequirePackage{supertabular}% extended tabular over several page

%- Improvement version of supertabular: incompatible! Because `glossaries` package is loading
%- `glossary-super.sty' which is based on `supertabular` package (see below)
%\RequirePackage{xtab}% 

%-- Spaces in tables

\RequirePackage{makecell}% helper package to create common layout for tabular material
%\setcellgapes{5pt}

%-- Extension of tabular environment: coloured cell-line, math-verbatim and new environment, etc.
%-- + `longtabu' env. if `longtable' loaded, compatibility with colortbl, delarray
%-- !!! Take care: this package is no more maintained (but seems powerful and useful too)

\RequirePackage{tabu}% requires `array' and `varwidth' packages + others if loaded

%- New length to set tabu width
\newlength{\tabuwidth}
%\setlength{\tabuwidth}{\textwidth+\marginparwidth+\marginparsep-\tabcolsep}
%- Fancy coloured tabular
\colorlet{tableLineOne}{black!15}
\colorlet{tableLineTwo}{black!25}
\colorlet{tableBackTitleColor}{maincolor}
%\rowcolors[\hline]{3}{green!25}{yellow!50}
%\rowcolors[\hline]{2}{tableLineOne}{tableLineTwo}
%\taburowcolors[2] 2{tableLineOne .. tableLineTwo}
%\tabulinesep = ^4mm_3mm
%\tabulinesep = ^2.5mm_2mm
%\everyrow{\tabucline[1mm  orange]-}
%\everyrow{\midrule}
\newcommand{\jazzTabHeaderStyle}{%
%  \rowfont{\bfseries\sffamily\leavevmode\color{white}}
%\noalign{\gdef\fontcolor{\color{blue}}}
  \rowcolor{tableBackTitleColor}
  %\Gape[3.5mm][1.5mm]{}% makecell cmd
}
%- yReport set-up
\everyrow{\tabucline[.4mm  white]{}}
\taburowcolors[2] 2{tableLineOne .. tableLineTwo}
\tabulinesep = ^2.5mm_2mm
\newcommand{\tableHeaderStyle}{
  \rowfont{\bfseries\sffamily\leavevmode\color{white}}
  \rowcolor{secondcolor}
  \Gape[3.5mm][1.5mm]{}
}

%-- Composition de tableaux esthétiques / Composing aesthetical tables

\RequirePackage{booktabs}% elegant tabulars TODO: trying colored lines with colortbl

%\RequirePackage{booktabscolor}% ejazz tiny add-on to the `booktabs' package: colored rules
%- Setting color rule with `booktabscolor' : BUG with cmidrule!!!
%\booktabsrulecolor{secondcolor}
%- Setting vertical space around rules
%- Setting rule width
%\setlength{\heavyrulewidth}{.08em}                %défaut=.08em
%\setlength{\lightrulewidth}{.05em}                %défaut=.5em
%\setlength{\cmidrulewidth}{.03em}                %défaut=.3em
%\setlength{\belowrulesep}{.55ex}                  %défaut=.65ex
%\setlength{\aboverulesep}{.45ex}                  %défaut=.4ex
%\setlength{\defaultaddspace}{.05em}              %défaut=.5em
%\setlength{\cmidrulekern}{.25em}                  %défaut=.25em
%\abovetopsep=0pt
%\cmidrulesep=\doublerulesep
%\cmidrulekern=.5em
%\defaultaddspace=.5em

%-- Combinaison de booktabs et colortbl : redéfinition des espaces à zéro

%-- Cf.: how-do-i-eliminate-the-vertical-realignment-when-using-arrayrulecolor-with-cmidrule
%-- → https://tex.stackexchange.com/questions/32362/

\setlength{\aboverulesep}{0pt}
\setlength{\belowrulesep}{0pt}
%\setlength{\extrarowheight}{0.25ex}

\newcommand*{\ruletabfiller}{%
  \arrayrulecolor[gray]{0.8}% change to cell colour
  \specialrule{\heavyrulewidth}{0pt}{-\heavyrulewidth}% "invisible" rule
  \arrayrulecolor{black}% revert to regular line colour
}

\colorlet{tableheadcolor}{gray!35} % Table header colour = 25% gray
\newcommand{\topline}{%
  \arrayrulecolor{black}%
  \specialrule{\heavyrulewidth}{\abovetopsep}{0pt}%
  \arrayrulecolor{tableheadcolor}%
  \specialrule{\belowrulesep}{0pt}{0pt}%
  \arrayrulecolor{black}%
}
\newcommand{\midline}{%
  \arrayrulecolor{tableheadcolor}%
  \specialrule{\aboverulesep}{0pt}{0pt}%
  \arrayrulecolor{black}%
  \specialrule{\lightrulewidth}{0pt}{0pt}%
  \arrayrulecolor{white}%
  \specialrule{\belowrulesep}{0pt}{0pt}%
  \arrayrulecolor{black}%
}

%-- Autre astuce (David Carslisle)

%- http://tex.stackexchange.com/questions/129713/tabular-environment-for-specified-width-bg-and-font-colorings-by-row
% >{\fontcolor}c  >{\fontcolor}l  >{\fontcolor}X
%\newcommand\fontcolor{}
%- Usage: \noalign{\gdef\fontcolor{\color{blue}}}

%-- Autre astuce pour gérer les fontes par ligne (Werner) avec `array.sty'
%\g@addto@macro{\endtabular}{\rowfont{}}% Clear row font
%\newcommand{\rowfonttype}{}% Current row font
%\newcommand{\rowfont}[1]{% Set current row font
%   \gdef\rowfonttype{#1}#1%
%}

%- Defining a mark for identical parnotes text (no incrementing): only the last parnote is displayed
%\newcommand{\jazzparnotemark}{\fnsymbol{1}}

%- Add-on to use with tabularx: \parnoteclear % tabularx will otherwise add each note thrice
%TODO: ne fonctionne pas avec tabularx !!!!!!!!!!
%- The below command `\parnoteclear' is now included in the package (2016-08-15)
%\def\parnoteclear{%
%    \gdef\PN@text{}%
%    \parnotereset
%}

\RequirePackage{threeparttable}
\def\TPTnoteLabel#1{\llap{#1.}\hfil}
%\def\TPTnoteLabel#1{\llap{\small\tnote{#1}}\hfil}
%\def\TPTnoteLabel#1{\llap{\normalsize\tnote{#1}}}

%-- Gestion de boîtes dans les tableaux (cf. `makecell' qui semble mieux intégrer ces possibilités)

%- Deux commandes :  \backslashbox{bas}{haut} (-\-} et \slashbox{bas}{haut} (-/-}
%- slasbox.sty n'est plus dans TeXLive (pb de licence), inclu et remplacé par diagbox.sty
%\RequirePackage{diagbox}











